<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>catfishAPIAgg - 管理面板</title>
    <!-- 引入 Google Font 'Inter' -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 引入样式表 -->
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <!-- 
      登录遮罩
    -->
    <div id="login-overlay">
        <div class="login-box card">
            <h2>catfishAPIAgg</h2>
            <p>管理员登录</p>
            <div class="input-group">
                <input type="password" id="admin-key-input" placeholder="请输入管理员密钥">
            </div>
            <p id="login-error" class="error-text"></p>
            <button id="login-button" class="button button-primary full-width">登录</button>
        </div>
    </div>

    <!-- 
      顶部导航栏
    -->
    <header id="top-bar" class="hidden">
        <div class="header-content">
            <h1>catfishAPIAgg - 面板</h1>
            <button id="logout-button" class="button button-secondary">退出登录</button>
        </div>
    </header>

    <!-- 
      主应用容器
    -->
    <div id="app-container" class="hidden">
        
        <main>
            <!-- 选项卡导航 -->
            <nav class="tabs card">
                <button class="tab-button active" data-tab="config">API 配置</button>
                <button class="tab-button" data-tab="stats">请求统计</button>
                <button class="tab-button" data-tab="logs">实时日志</button>
            </nav>

            <!-- 
              选项卡内容
            -->

            <!-- 1. API 配置 -->
            <section id="config-tab" class="tab-content card active">
                <h2>API 配置项</h2>
                <!-- [重构] 配置项将按方案动态生成到这里 -->
                <div id="config-schemes-container">
                    <p>加载中...</p>
                </div>

                <!-- [重构] 表单现在是内嵌卡片 -->
                <div class="card form-card">
                    <h3 id="form-title">添加新配置</h3>
                    <form id="config-form">
                        <!-- 隐藏的 ID 字段，用于编辑 -->
                        <input type="hidden" id="config-id">
                        
                        <div class="form-grid">
                            <!-- [新增] 方案名称输入框 -->
                            <div class="input-group">
                                <label for="config-scheme">方案名称 (作为 Model Name)</label>
                                <input type="text" id="config-scheme" placeholder="例如: gpt-4-turbo" required>
                            </div>
                            <div class="input-group">
                                <label for="config-priority">优先级 (数字越小越优先)</label>
                                <input type="number" id="config-priority" placeholder="例如: 1" required>
                            </div>
                            <div class="input-group full-span">
                                <label for="config-url">API 终端 URL</label>
                                <input type="text" id="config-url" placeholder="https://api.openai.com/v1" required>
                            </div>
                            <div class="input-group full-span">
                                <label for="config-key">API Key</label>
                                <input type="password" id="config-key" placeholder="sk-..." required>
                            </div>
                            <div class="input-group full-span">
                                <label for="config-model">覆盖 Model (选填)</label>
                                <input type="text" id="config-model" placeholder="留空则使用原始请求的 model">
                            </div>
                            <!-- [新增] 熔断机制输入框 -->
                            <div class="input-group">
                                <label for="config-failure-threshold">连续失败阈值 (选填)</label>
                                <input type="number" id="config-failure-threshold" placeholder="例如: 3 (次)">
                            </div>
                            <div class="input-group">
                                <label for="config-disable-duration">禁用时长 (秒, 选填)</label>
                                <input type="number" id="config-disable-duration" placeholder="例如: 1800 (秒)">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" id="save-button" class="button button-primary">保存</button>
                            <button type="button" id="cancel-button" class="button button-secondary hidden">取消</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- 2. 请求统计 -->
            <section id="stats-tab" class="tab-content card">
                <h2>统计概览</h2>
                <div class="stats-grid">
                    <div class="stat-card card">
                        <h4>总计成功</h4>
                        <p id="stat-total-success" class="success-text">0</p>
                    </div>
                    <div class="stat-card card">
                        <h4>总计失败</h4>
                        <p id="stat-total-fail" class="fail-text">0</p>
                    </div>
                    <div class="stat-card card">
                        <h4>今日成功</h4>
                        <p id="stat-today-success" class="success-text">0</p>
                    </div>
                    <div class="stat-card card">
                        <h4>今日失败</h4>
                        <p id="stat-today-fail" class="fail-text">0</p>
                    </div>
                </div>

                <h3 class="mt-2">按配置统计 (历史总计)</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>URL</th>
                                <th class="success-text">成功</th>
                                <th class="fail-text">失败</th>
                                <th>连续失败</th>
                                <th>禁用至</th>
                            </tr>
                        </thead>
                        <tbody id="stats-by-config-body">
                            <tr><td colspan="6">加载中...</td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- [新增] 今日按配置统计表格 -->
                <h3 class="mt-2">按配置统计 (今日)</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>URL</th>
                                <th class="success-text">成功</th>
                                <th class="fail-text">失败</th>
                            </tr>
                        </thead>
                        <tbody id="stats-today-by-config-body">
                            <tr><td colspan="4">加载中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 3. 实时日志 -->
            <section id="logs-tab" class="tab-content card">
                <h2>实时日志 (最新 200 条)</h2>
                <div class="logs-container">
                    <pre id="logs-content">加载中...</pre>
                </div>
            </section>
        </main>
    </div>

    <!-- 引入 JS (defer 确保 DOM 加载完毕) -->
    <script src="/static/app.js" defer></script>
</body>
</html>